<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ict.project.mapper.TrainingDiaryMapper">
    <select id="search" parameterType="Map" resultType="com.ict.project.vo.TrainingDiaryVO">
        select * 
        from 
        (select @RN:=@RN+1 as rnum, a.* 
        from (select * from trainingdiary_t
            <where>
                <trim suffixOverrides="and">
                    c_idx =#{c_idx} and
                    <if test="select !=null and select == 1">write_date = #{value}</if>
                </trim>
            </where>
            order by write_date desc
        )a ,(select @RN:=0) b) c 
        where c.rnum between #{begin} and #{end} 
    </select>
     <select id="search_count" parameterType="Map" resultType="int">
        select count(*)
        from 
        (select @RN:=@RN+1 as rnum, a.* 
        from (select * from trainingdiary_t
            <where>
                <trim suffixOverrides="and">
                    c_idx =#{c_idx} and
                    <if test="select !=null and select == 1">write_date = #{value}</if>
                </trim>
            </where>
            order by write_date desc
        )a ,(select @RN:=0) b) c 
    </select>
    <select id="course_list" parameterType="Map" resultType="com.ict.project.vo.TrainingDiaryVO">
        select * 
            from 
            (select @RN:=@RN+1 as rnum, a.* 
                from (select * from trainingdiary_t
                    where c_idx =#{c_idx}
                        order by write_date desc
                )a ,(select @RN:=0) b) c 
            where c.rnum between #{begin} and #{end} 
    </select>
    <select id="list_count" parameterType="Map" resultType="int">
        select count(*) 
            from 
            (select @RN:=@RN+1 as rnum, a.* 
                from (select * from trainingdiary_t
                    where c_idx =#{c_idx}
                )a ,(select @RN:=0) b) c 
    </select>
    <insert id="add_td" parameterType="com.ict.project.vo.TrainingDiaryVO">
        insert into trainingdiary_t
        (write_date, td_attend, td_tardy, td_earlyLeave, td_instruction, td_significant,
        c_idx, admin_check, ceo_check, attend_check, tardy_check, earlyLeave_check, classTime, s_name, sf_name, s_detail) 
        values 
        (#{write_date}, #{td_attend}, #{td_tardy}, #{td_earlyLeave}, #{td_instruction}, #{td_significant}, #{c_idx}, #{admin_check}, #{ceo_check}, 
        #{attend_check}, #{tardy_check}, #{earlyLeave_check}, #{classTime}, #{s_name}, #{sf_name}, #{s_detail})
    </insert>
</mapper>