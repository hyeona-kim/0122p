<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ict.project.mapper.TraineeMapper">
  <resultMap type="com.ict.project.vo.TraineeVO" id="map1">
		<association property="cvo" column="c_idx" javaType="com.ict.project.vo.CourseVO" select="course"></association>
	</resultMap>
<select id="all" resultType="com.ict.project.vo.TraineeVO">
	select * from trainee_t
</select>

<select id="count" resultType="int">
		select count(*) from trainee_t
    where status = 0
</select>

 <select id="list" resultType="com.ict.project.vo.TraineeVO">
		select * from trainee_t
		where status = 0
</select>

<select id="view" parameterType="String" resultType="com.ict.project.vo.TraineeVO">
	select * from trainee_t
	where tr_idx = #{tr_idx} 
</select>

<update id="trainedit" parameterType="String">
	update trainee_t
	<set>
		tr_name = #{tr_name},
		tr_rrn = #{tr_rrn},
		tr_phone = #{tr_phone},
		tr_hp = #{tr_hp},
		<if test="tr_cancel_date != null">tr_cancel_date = #{tr_cancel_date},</if>
		<if test="tr_cancel_text != null">tr_cancel_text = #{tr_cancel_text},</if>
		<if test="tr_hrd != null">tr_hrd = #{tr_hrd},</if>
		<if test="tr_refund != null">tr_refund = #{tr_refund},</if>
		<if test="tr_bc != null">tr_bc = #{tr_bc},</if>
		<if test="tr_charge != null">tr_charge = #{tr_charge},</if>
		<if test="tr_total_fee != null">tr_total_fee = #{tr_total_fee},</if>
		<if test="tr_card != null">tr_card = #{tr_card},</if>
		t_path = #{t_path},
		file_name = #{file_name},
		ori_name = #{ori_name}
	</set>
	where tr_idx = #{tr_idx}
</update>

<select id="getcard" resultType="com.ict.project.vo.TraineeVO">
	select * from trainee_t order by tr_idx
</select>

<!-- 훈련생현황에서 교육생 삭제할때 쓰임 -->
<update id="del" parameterType="String">
	update trainee_t
	set status = 1
	where tr_idx = #{tr_idx} and c_idx = #{c_idx}

</update>

<select id="clist" resultType="com.ict.project.vo.TraineeVO" parameterType="String">
	select * from trainee_t
	where status = 0 and c_idx = ${c_idx}
</select>

<select id="tlist" resultType="com.ict.project.vo.TraineeVO" parameterType="String">
	select * from trainee_t
	where tr_idx = #{tr_idx} and c_idx = ${c_idx}
</select>

<update id="nowstatus" parameterType="String">
	update trainee_t
	set tr_nowstatus = #{tr_nowstatus}
	where tr_idx = ${tr_idx}
</update>

<select id="course_count" parameterType="String" resultType="int">
	select count(*) from trainee_t where c_idx = #{c_idx}
</select>

<select id="search_count" parameterType="Map" resultType="int">
	select count(*) 
				from 
				(select @RN:=@RN+1 as rnum, a.* 
				from (select t.* from trainee_t t, course_t c
					<where>
						<trim suffixOverrides="and">
								t.status = 0 and t.c_idx = c.c_idx and
								<if test="select !=null and select == 4">tr_name like concat('%', #{value}, '%') and</if>
								<if test="year !=null">start_date like concat(#{year},'%') and</if>
						</trim>
					</where>
				)a ,(select @RN:=0) b) c 
</select>

<select id="searchValue_count" parameterType="Map" resultType="int">
	select count(*) 
				from 
				(select @RN:=@RN+1 as rnum, a.* 
				from (select t.* from trainee_t t, course_t c
					<where>
						<trim suffixOverrides="and">
								t.status = 0 and t.c_idx = c.c_idx and t.c_idx = #{c_idx} and
								<if test="select !=null and select == 4">tr_name like concat('%', #{value}, '%') and</if>
								<if test="year !=null">start_date like concat(#{year},'%') and</if>
						</trim>
					</where>
				)a ,(select @RN:=0) b) c 
</select>

<select id="course_searchValue" parameterType="Map" resultMap="map1">
	select * 
			from 
			(select @RN:=@RN+1 as rnum, a.* 
			from (select t.* from trainee_t t, course_t c
				<where>
					<trim suffixOverrides="and">
						    t.status = 0 and t.c_idx = c.c_idx and t.c_idx = #{c_idx} and
							<if test="select !=null and select == 4">tr_name like concat('%', #{value}, '%') and</if>
							<if test="year !=null">start_date like concat(#{year},'%') and</if>
					</trim>
				</where>
				order by tr_idx desc
			)a ,(select @RN:=0) b) c 
			where c.rnum between ${begin} and ${end}
</select>

<select id="course_search" parameterType="Map" resultMap="map1">
	select * 
			from 
			(select @RN:=@RN+1 as rnum, a.* 
			from (select t.* from trainee_t t, course_t c
				<where>
					<trim suffixOverrides="and">
						    t.status = 0 and t.c_idx = c.c_idx and
							<if test="select !=null and select == 4">tr_name like concat('%', #{value}, '%') and</if>
							<if test="year !=null">start_date like concat(#{year},'%') and</if>
					</trim>
				</where>
				order by tr_idx desc
			)a ,(select @RN:=0) b) c 
			where c.rnum between ${begin} and ${end}
</select>

<select id="course" resultType="com.ict.project.vo.CourseVO" parameterType="String">
	select * from course_t where c_idx = #{c_idx}
</select>
<select id="course_list" parameterType="Map" resultMap="map1">
	select * 
		from 
		(select @RN:=@RN+1 as rnum, a.* from 
		(select * from trainee_t t WHERE t.status = 0 and t.c_idx= #{c_idx} order by tr_idx desc)a ,(select @RN:=0) b) c 
		where c.rnum between ${begin} and ${end}
</select>
</mapper>